{
    "manifests": {
        "shopware/docker": {
            "manifest": {
                "copy-from-recipe": {
                    "docker/": "docker/",
                    "config/": "%CONFIG_DIR%/"
                },
                "post-install-output": [
                    "  * <fg=blue>Setup</>",
                    "    This recipe has created a <comment>docker/Dockerfile</comment> with an example file to build a Shopware Docker image.",
                    "    You can build it with <comment>docker build -t <name> -f docker/Dockerfile .</comment>.",
                    "    Make sure you to set a correct `APP_SECRET`, you can generate one with `openssl rand -hex 128`",
                    "    See https://github.com/shopware/docker for the complete documentation to configure things."
                ]
            },
            "files": {
                "config/packages/prod/monolog.yaml": {
                    "contents": [
                        "monolog:",
                        "    handlers:",
                        "        main:",
                        "            type: fingers_crossed",
                        "            action_level: error",
                        "            handler: nested",
                        "            excluded_http_codes: [404, 405]",
                        "            buffer_size: 50",
                        "        nested:",
                        "            type: stream",
                        "            path: php://stderr",
                        "            level: error",
                        "            formatter: monolog.formatter.json",
                        "        console:",
                        "            type: console",
                        "            process_psr_3_messages: false",
                        "            channels: [\"!event\", \"!doctrine\"]",
                        "        business_event_handler_buffer:",
                        "            level: error",
                        ""
                    ],
                    "executable": false
                },
                "docker/Dockerfile": {
                    "contents": [
                        "#syntax=docker/dockerfile:1.4",
                        "",
                        "# pin versions",
                        "FROM ghcr.io/shopware/docker-base:8.4 AS base-image",
                        "FROM ghcr.io/shopware/shopware-cli:latest-php-8.3 AS shopware-cli",
                        "",
                        "# build",
                        "",
                        "FROM shopware-cli AS build",
                        "",
                        "ARG SHOPWARE_PACKAGES_TOKEN",
                        "",
                        "ADD . /src",
                        "WORKDIR /src",
                        "",
                        "ENV SHOPWARE_CACHE_ID=docker",
                        "",
                        "RUN --mount=type=secret,id=composer_auth,dst=/src/auth.json \\",
                        "    --mount=type=cache,target=/root/.composer \\",
                        "    --mount=type=cache,target=/root/.npm \\",
                        "    /usr/local/bin/entrypoint.sh shopware-cli project ci /src",
                        "",
                        "# build final image",
                        "",
                        "FROM base-image",
                        "",
                        "ENV SHOPWARE_DISABLE_UPDATE_CHECK=1",
                        "",
                        "COPY --from=build --chown=82 --link /src /var/www/html",
                        ""
                    ],
                    "executable": false
                }
            },
            "ref": "7524bc00baa0f64349d92ef0fbcdb02669dcd9b9"
        }
    }
}
